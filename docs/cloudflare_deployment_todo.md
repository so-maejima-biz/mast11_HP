# ホームページ公開 準備リスト

---

## 最初に決めること

### 運用方法の選択

ホームページをどのアカウントで運用するか決めてください。

| 方法 | 説明 | メリット | デメリット |
|------|------|----------|------------|
| **A: 開発者のアカウント** | 現在の開発環境をそのまま本番利用 | 設定がシンプル、すぐに公開可能 | お客様は管理画面にアクセスできない |
| **B: お客様のアカウント** | お客様のCloudflareで新規作成 | 将来の引き渡しが容易 | 初期設定に追加作業が必要 |

**判断基準：**
- 長期的にサポートする関係 → **方法A**でも問題なし
- いずれ完全に引き渡したい → **方法B**推奨

> **保守について：**
> どちらを選んでも、日常的な保守は不要です（静的サイトのため）。
> コンテンツ変更（テキスト・画像差し替え等）は都度対応となります。
> 方法Aでも第三者への保守引き継ぎは可能です（アカウント情報を共有するだけ）。

**決定：**
- [ ] 方法A（開発者のアカウントで運用）
- [ ] 方法B（お客様のアカウントで運用）

---

## 現状の確認

### ドメイン管理状況

| 項目 | 状態 |
|------|------|
| ドメイン | mast11.com |
| 管理先 | **お名前.com**（GMO Internet） |
| ネームサーバー | dnsv.jp（お名前.comのDNS） |

**重要：** ドメインはお名前.comで管理されているため、DNS設定（CNAMEレコード追加）はお名前.comで行う必要があります。

### 開発環境

| 項目 | 状態 |
|------|------|
| 開発用URL | https://mast11-hp.pages.dev |
| ホスティング | Cloudflare Pages（開発者アカウント） |
| お問い合わせAPI | 実装済み（Resend連携が必要） |

---

## お客様にお願いすること

### 1. 運用方法を決める（上記参照）

### 2. お名前.comのログイン情報
ドメインのDNS設定を行うために必要です。

**ご準備いただくもの：**
- [ ] お名前.comに登録しているメールアドレス（またはお名前ID）
- [ ] お名前.comのパスワード
- ※2段階認証がある場合は、一緒に画面を見ながら作業します

> **お客様への説明：**
> 「ホームページのアドレス（mast11.com）を設定するために、
> ドメインを管理しているお名前.comの設定画面にアクセスする必要があります。」

### 3. お問い合わせの受信先メールアドレス
ホームページからお問い合わせがあった際、どのメールアドレスに届けるかを決めてください。

**例：**
- [ ] info@mast11.com
- [ ] 担当者様の個人メール
- [ ] その他（                    ）

### 4. Resendアカウントについて（説明のみ）
お問い合わせフォームからメールを送信するためのサービスです。
**無料で使えます**（月3,000通まで無料）。

> **お客様への説明：**
> 「お問い合わせフォームからメールを送るために、Resendというサービスを使います。
> 最初は私のほうでアカウントを作成して設定を済ませます。
> 設定完了後、アカウントの持ち主を御社に変更しますので、
> その際に御社のメールアドレスをお教えください。
> 変更後は御社名義のアカウントになり、私はログインできなくなります。」

**お客様に決めてもらうこと：**
- [ ] Resendアカウントに使うメールアドレス（info@mast11.com など）

### 5. 保守について（説明）

> **お客様への説明：**
> 「ホームページは基本的にメンテナンス不要で動き続けます。
> SSL証明書の更新やサーバー管理は自動で行われます。
> テキストや画像の変更が必要な場合は、その都度ご連絡ください。
> 1回あたり5,000〜15,000円程度（変更内容による）でお受けします。」

**お客様に確認すること：**
- [ ] 保守の連絡先（メール or 電話）
- [ ] 請求先情報（必要な場合）

---

## 私（開発者）が実施する作業

### Step 1: 事前確認
- [ ] 運用方法（A or B）を確認
- [ ] お名前.comログイン情報を受領
- [ ] お問い合わせ受信先メールアドレスを確認
- [ ] Resendに使うメールアドレスを確認

### Step 2: Resendアカウント作成・設定
- [x] https://resend.com で私のメールアドレスで登録
- [x] APIキーを発行（API Keys → Create API Key → Name: 任意、Permission: Sending access）
- [x] **キーは一度しか表示されない**のですぐにメモ
- [x] ドメイン認証を追加（Domains → Add Domain → mast11.com）
- [x] 表示されたDNSレコード（TXT 2-3件、MX 1件）を下記 Step 3-2 のテーブルに記入

### Step 3: お名前.comでDNS設定

お名前.comの管理画面でDNSレコードを追加します。

**3-1: サイト公開用のCNAMEレコード**

| ホスト名 | タイプ | 値 |
|----------|--------|-----|
| `@` または空欄 | CNAME | `mast11-hp.pages.dev` |
| `www` | CNAME | `mast11-hp.pages.dev` |

> ※お名前.comでは「@」（ルートドメイン）にCNAMEを設定できない場合があります。
> その場合はAレコード（Cloudflare PagesのIP）を使用するか、
> wwwのみ設定してリダイレクトする方法を検討。

**3-2: メール送信用のDNSレコード（Resend認証）**

Resendが指示するレコードを追加（4件）

| ホスト名 | タイプ | 値 | 優先度 |
|----------|--------|-----|--------|
| `resend._domainkey` | TXT | `p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO6SWEa+VfJj0WopfJ2qZiyJgECGDTAwvhXunv4UY3DJew6Yy4aH3t2R7LZlic20UhYqX0wr/JAIspyhtNIDNI6v7w90zaQ12qB6SIpJOkWxHBUoMMag2VccESirPo0cjh+zP8nDEW+mpjwD6kgAgn+eA2Pyem5oBfDLiFQTn0TQIDAQAB` | - |
| `send` | MX | `feedback-smtp.ap-northeast-1.amazonses.com` | 10 |
| `send` | TXT | `v=spf1 include:amazonses.com ~all` | - |
| `_dmarc` | TXT | `v=DMARC1; p=none;` | - |

**3-3: Resend でドメイン認証を確認**

- [x] DNS 反映を待つ（数分〜数時間） ← お名前.com での DNS レコード追加済み（2026-02-11）
- [x] Resend ダッシュボード → Domains → `mast11.com` の **Verify** をクリック
- [x] ステータスが **Verified** になった（DKIM, SPF, MX 全て Verified — 2026-02-11 確認済み）

### Step 4: ローカル環境変数を設定（`.dev.vars`）

プロジェクトルートに `.dev.vars` を作成（`.gitignore` に含まれているので git にはコミットされない）:

```
TO_EMAIL=受信したいメールアドレス（カンマ区切りで複数可）
RESEND_API_KEY=re_ここにAPIキー
```

例:
```
TO_EMAIL=person1@example.com,person2@example.com
RESEND_API_KEY=re_abc123xyz
```

ローカルで動作確認:
```powershell
$env:PATH = "C:\Program Files\nodejs;" + $env:PATH
npm run preview
```
> ※ PowerShell で `npm` が見つからない場合は、上記のように PATH を通してから実行する

- [x] `.dev.vars` を作成・設定済み（2026-02-11）
- [x] http://localhost:8788 でフォーム送信テスト（2026-02-11 確認済み）
- [x] `TO_EMAIL` に指定したアドレスにメールが届くか確認（2026-02-11 確認済み）

### Step 5: Cloudflare Pages設定

> **決定事項:** 開発者アカウント（方法A）で運用。カスタムドメインは `www.mast11.com` を使用（DNS移行不要のCNAMEセットアップ）。

**5-1: カスタムドメイン追加**
- [x] カスタムドメインタブ → `www.mast11.com` を追加
- [x] 「CNAMEセットアップを開始」を選択（DNS移行なし）
- [x] お名前.comで CNAME レコードを追加（`www` → `mast11-hp.pages.dev`）（2026-02-11）
- [ ] Cloudflare で「DNSレコードを確認」→ アクティブになる（DNS反映待ち）

**5-2: 環境変数設定**
- [x] 設定タブ → Variables and Secrets で以下を追加（2026-02-11 設定済み）

  | 変数名 | Type |
  |--------|------|
  | `TO_EMAIL` | テキスト |
  | `RESEND_API_KEY` | シークレット |

  Environment: Production

**5-3: デプロイ反映**
- [ ] Deployments → 最新デプロイの … → Retry deployment（環境変数を反映させる）

**5-4: `mast11.com` → `www.mast11.com` リダイレクト設定**
- [ ] お名前.comの転送設定で `mast11.com` → `https://www.mast11.com` にリダイレクト

### Step 6: 本番動作確認
- [ ] https://www.mast11.com にアクセスして表示確認
- [ ] お問い合わせフォームからテスト送信
- [ ] 指定メールアドレスに届くか確認
- [ ] スマートフォンで表示確認
- [ ] 届かない場合:
  - Resend ダッシュボード → Logs でエラー確認
  - Cloudflare ダッシュボード → Functions → ログ確認
  - 迷惑メールフォルダも確認

### Step 7: Resendアカウントをお客様に移行
- [ ] Resendにログイン → Settings → Account
- [ ] メールアドレスを私のアドレス → お客様のアドレスに変更
- [ ] お客様のメールに届く確認メールをクリックしてもらう（お客様に依頼）
- [ ] お客様にパスワードリセットしてもらう（またはこちらで仮パスワードを設定して共有）

> **お客様への連絡テンプレート：**
> 「Resendアカウントの移行作業を行いました。
> ○○@○○.com 宛に確認メールが届いていますので、
> メール内のリンクをクリックして認証をお願いします。
> その後、以下のURLからパスワードを設定してください。
> https://resend.com/forgot-password 」

### Step 8: 後処理
- [ ] 方法Bの場合：開発環境（私のアカウント）を削除
- [ ] お客様にアカウント情報一覧を共有

---

## お客様への共有用テンプレート

作業完了後、以下をお客様に共有します：

**方法Aの場合：**
```
■ ホームページ
URL: https://mast11.com

■ Resend（メール送信サービス）
URL: https://resend.com/
メール: （お客様のメール）
パスワード: （お客様が設定）

■ お名前.com（ドメイン管理）
URL: https://www.onamae.com/
メール: （お客様のメール）
パスワード: （お客様管理）

■ 運用について
・基本的にメンテナンスは不要です
・内容変更が必要な場合はご連絡ください
・変更対応: 1回 5,000〜15,000円（内容による）
```

**方法Bの場合：**
```
■ ホームページ
URL: https://mast11.com

■ Cloudflare（ホームページ管理）
URL: https://dash.cloudflare.com/
メール: （お客様のメール）
パスワード: （お客様管理）

■ Resend（メール送信サービス）
URL: https://resend.com/
メール: （お客様のメール）
パスワード: （お客様が設定）

■ お名前.com（ドメイン管理）
URL: https://www.onamae.com/
メール: （お客様のメール）
パスワード: （お客様管理）

■ 運用について
・基本的にメンテナンスは不要です
・内容変更が必要な場合はご連絡ください
・変更対応: 1回 5,000〜15,000円（内容による）
```

---

## 補足：なぜこれらが必要か

| 項目 | 説明 |
|------|------|
| **お名前.com** | ドメイン（mast11.com）を管理しているサービス。DNS設定はここで行う |
| **Cloudflare Pages** | ホームページを世界中に配信するサービス。高速・安全・無料 |
| **Resend** | お問い合わせフォームからメールを送るサービス。無料枠で十分 |
| **APIキー** | メールを送るための"鍵"。これがないと送信できない |
| **ドメイン認証** | 迷惑メール扱いされないための設定。mast11.comからの送信を証明する |
| **CNAMEレコード** | 「mast11.comにアクセスしたらCloudflare Pagesを表示する」という設定 |

---

## 保守について（参考）

### 保守頻度
このサイトの場合、日常的な保守はほぼ不要です。

| 項目 | 頻度 | 理由 |
|------|------|------|
| SSL証明書更新 | 不要 | Cloudflareが自動更新 |
| サーバーメンテナンス | 不要 | Cloudflare Pagesが管理 |
| セキュリティパッチ | 年1-2回程度 | 依存パッケージの更新 |
| コンテンツ変更 | お客様次第 | テキスト・画像の差し替え |

### 保守費用の目安

| 契約形態 | 相場 | 内容 |
|----------|------|------|
| **スポット対応** | 5,000〜15,000円/回 | 都度依頼。テキスト変更、画像差し替え等 |
| **月額固定** | 5,000〜10,000円/月 | 月1-2回の変更対応込み |
| **年間契約** | 30,000〜60,000円/年 | 年数回の変更対応込み |

**このサイトへの推奨：** スポット対応（変更があったときだけ）

### 第三者への引き継ぎ
方法Aを選択しても、将来的に第三者に保守を依頼することは可能です。
- Cloudflareアカウントへのアクセス権を共有
- GitHubリポジトリへのアクセス権を共有
- Resendアカウント情報を共有
